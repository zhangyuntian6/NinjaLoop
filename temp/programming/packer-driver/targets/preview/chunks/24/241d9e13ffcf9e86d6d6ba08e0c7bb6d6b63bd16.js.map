{"version":3,"sources":["file:///D:/NinjaLoop/assets/Script/Life.ts"],"names":["LifeManager","weightRandom","Property","Event","talentMgr","Achievement","ConfigManager","constructor","_property","_event","_talent","_achievement","_triggerTalents","initial","age","talents","events","achievements","Promise","all","readJson","restart","allocation","contents","talentReplace","TLT","doTalent","restartLastStep","achieve","Opportunity","START","getTalentAllocationAddition","allocationAddition","getTalentCurrentTriggerCount","talentId","next","event","talent","ageNext","talentContent","eventContent","doEvent","random","isEnd","content","TRAJECTORY","result","replace","id","push","source","get","target","type","change","TYPES","filter","max_triggers","do","effect","name","description","grade","eventId","postEvent","EVT","validEvents","check","length","allRandomEvents","getRandomEvents","eligibleRandomEvents","eventDetails","NoRandom","randomIndex","Math","floor","randomEventId","console","warn","talentRandom","times","TMS","achievement","CACHV","getLastExtendTalent","talentExtend","set","EXT","getSummary","SUMMARY","AGE","HAGE","CHR","HCHR","INT","HINT","STR","HSTR","MNY","HMNY","SPR","HSPR","SUM","getLastRecord","exclusive","getAchievements","ticks","ACHV","forEach","tick","list","sort","a","ag","hide","ah","b","bg","bh","getTotal","CTLT","CEVT","totalTalent","count","totalEvent","talentRate","eventRate","v","END","lifeMgr"],"mappings":"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","sourcesContent":["import { weightRandom } from './functions/util'\nimport Property from './property';\nimport Event from './event';\nimport { ITalentData, TalentManager, talentMgr } from './Talent';\nimport { Achievement, IListAchievementData } from './achievement';\nimport ConfigManager from './Utils/ConfigManager';\n\ninterface ITalentReplacementInfo {\n    type: string;\n    source: ITalentData;\n    target: ITalentData;\n}\n\ninterface ITrackData {\n    age: number;\n    content: any[];\n    isEnd: boolean;\n}\n\nclass LifeManager {\n    constructor() {\n        this._property = new Property();\n        this._event = new Event();\n        this._talent = talentMgr;\n        this._achievement = new Achievement();\n    }\n\n    _property;\n    _event;\n    _talent: TalentManager;\n    _achievement;\n    _triggerTalents;\n\n    async initial() {\n        \n        const [age, talents, events, achievements] = await Promise.all([\n            ConfigManager.readJson('age'),\n            ConfigManager.readJson('talents'),\n            ConfigManager.readJson('events'),\n            ConfigManager.readJson('achievement'),\n        ])\n        this._property.initial({age});\n        this._talent.initial({talents});\n        this._event.initial({events});\n        this._achievement.initial({achievements});\n    }\n\n    restart(allocation) {\n        this._triggerTalents = {};\n        const contents = this.talentReplace(allocation.TLT);\n        this._property.restart(allocation);\n        this.doTalent();\n        this._property.restartLastStep();\n        this._achievement.achieve(\n            this._achievement.Opportunity.START,\n            this._property\n        )\n        return contents;\n    }\n\n    getTalentAllocationAddition(talents) {\n        return this._talent.allocationAddition(talents);\n    }\n\n    getTalentCurrentTriggerCount(talentId) {\n        return this._triggerTalents[talentId] || 0;\n    }\n\n    next(): ITrackData {\n        const {age, event, talent} = this._property.ageNext();\n\n        const talentContent = this.doTalent(talent);\n        const eventContent = this.doEvent(this.random(event));\n\n        const isEnd = this._property.isEnd();\n\n        const content = [...talentContent, ...eventContent];\n        this._achievement.achieve(\n            this._achievement.Opportunity.TRAJECTORY,\n            this._property\n        )\n        return { age, content, isEnd };\n    }\n\n    talentReplace(talents): ITalentReplacementInfo[] {\n        const result = this._talent.replace(talents);\n        const contents = [];\n        for(const id in result) {\n            talents.push(result[id]);\n            const source = this._talent.get(id);\n            const target = this._talent.get(result[id]);\n            contents.push({\n                type: 'talentReplace',\n                source, target\n            });\n        }\n        return contents;\n    }\n\n    doTalent(talents?: any[]) {\n        if(talents) this._property.change(this._property.TYPES.TLT, talents);\n        talents = this._property.get(this._property.TYPES.TLT)\n            .filter(talentId => this.getTalentCurrentTriggerCount(talentId) < this._talent.get(talentId).max_triggers);\n\n        const contents = [];\n        for(const talentId of talents) {\n            const result = this._talent.do(talentId, this._property);\n            if(!result) continue;\n            this._triggerTalents[talentId] = this.getTalentCurrentTriggerCount(talentId) + 1;\n            const { effect, name, description, grade } = result;\n            contents.push({\n                type: this._property.TYPES.TLT,\n                name,\n                grade,\n                description,\n            })\n            if(!effect) continue;\n            this._property.effect(effect);\n        }\n        return contents;\n    }\n\n    doEvent(eventId) {\n        if (eventId === null) { // Handle case where no event was selected\n            return []; // Return empty array or a default \"no event\" content if needed\n        }\n        const { effect, next, description, postEvent } = this._event.do(eventId, this._property);\n        this._property.change(this._property.TYPES.EVT, eventId);\n        this._property.effect(effect);\n        const content = {\n            type: this._property.TYPES.EVT,\n            description,\n            postEvent,\n        }\n        if(next) return [content, ...this.doEvent(next)];\n        return [content];\n    }\n\n    random(events) {\n        const validEvents = events.filter(\n            ([eventId]) => this._event.check(eventId, this._property)\n        );\n\n        if (validEvents.length === 0) {\n            // If no valid events, choose a random event with ID starting with 'RDM'\n            const allRandomEvents = this._event.getRandomEvents();\n            // Filter out RDM events that have NoRandom: 1\n            const eligibleRandomEvents = allRandomEvents.filter(eventId => {\n                const eventDetails = this._event.get(eventId);\n                return !eventDetails.NoRandom;\n            });\n\n            if (eligibleRandomEvents.length > 0) {\n                const randomIndex = Math.floor(Math.random() * eligibleRandomEvents.length);\n                const randomEventId = eligibleRandomEvents[randomIndex];\n                // Return just the event ID string for the fallback case\n                return randomEventId;\n            } else {\n                // No valid events and no eligible RDM events found.\n                console.warn(\"No valid events and no eligible RDM events found.\");\n                return null; // Return null to indicate no event was selected\n            }\n        } else {\n            // Otherwise, use weightRandom on the valid events\n            return weightRandom(validEvents);\n        }\n    }\n\n    talentRandom() {\n        const times = this._property.get(this._property.TYPES.TMS);\n        const achievement = this._property.get(this._property.TYPES.CACHV);\n        return this._talent.talentRandom(this.getLastExtendTalent(), { times, achievement });\n    }\n\n    talentExtend(talentId) {\n        this._property.set(this._property.TYPES.EXT, talentId);\n    }\n\n    getLastExtendTalent() {\n        return this._property.get(this._property.TYPES.EXT);\n    }\n\n    getSummary() {\n        this._achievement.achieve(\n            this._achievement.Opportunity.SUMMARY,\n            this._property\n        )\n        return {\n            AGE: this._property.get(this._property.TYPES.HAGE),\n            CHR: this._property.get(this._property.TYPES.HCHR),\n            INT: this._property.get(this._property.TYPES.HINT),\n            STR: this._property.get(this._property.TYPES.HSTR),\n            MNY: this._property.get(this._property.TYPES.HMNY),\n            SPR: this._property.get(this._property.TYPES.HSPR),\n            SUM: this._property.get(this._property.TYPES.SUM),\n        };\n    }\n\n    getLastRecord() {\n        return this._property.getLastRecord();\n    }\n\n    exclusive(talents, exclusive) {\n        return this._talent.exclusive(talents, exclusive);\n    }\n\n    getAchievements(): IListAchievementData[] {\n        const ticks = {};\n        this._property\n            .get(this._property.TYPES.ACHV)\n            .forEach(([id, tick]) => ticks[id] = tick);\n        return this\n            ._achievement\n            .list(this._property)\n            .sort((\n                {id: a, grade: ag, hide: ah},\n                {id: b, grade: bg, hide: bh}\n            )=>{\n                a = ticks[a];\n                b = ticks[b];\n                if(a&&b) return b - a;\n                if(!a&&!b) {\n                    if(ah&&bh) return bg - ag;\n                    if(ah) return 1;\n                    if(bh) return -1;\n                    return bg - ag;\n                }\n                if(!a) return 1;\n                if(!b) return -1;\n            });\n    }\n\n    getTotal() {\n        const TMS = this._property.get(this._property.TYPES.TMS);\n        const CACHV = this._property.get(this._property.TYPES.CACHV);\n        const CTLT = this._property.get(this._property.TYPES.CTLT);\n        const CEVT = this._property.get(this._property.TYPES.CEVT);\n\n        const totalTalent = this._talent.count();\n        const totalEvent = this._event.count();\n\n        return {\n            times: TMS,\n            achievement: CACHV,\n            talentRate: CTLT / totalTalent,\n            eventRate: CEVT / totalEvent,\n        }\n    }\n\n    get times() { return this._property?.get(this._property.TYPES.TMS) || 0; }\n    set times(v) {\n        this._property?.set(this._property.TYPES.TMS, v) || 0;\n        this._achievement.achieve(\n            this._achievement.Opportunity.END,\n            this._property\n        )\n    }\n}\n\nconst lifeMgr = new LifeManager();\nexport { lifeMgr };\nexport type { ITrackData };\n"]}